# rscripts

## LDpred2.Rmd

We here provide an R markdown file (`LDpred2.Rmd`) which can be executed using built containers either in Docker (locally) or Singularity (typically HPC) formats.
The R script is based on an example/tutorial from the [`bigsnpr` GitHub repository](https://github.com/privefl/bigsnpr),
specifically [R markdown file](https://github.com/privefl/bigsnpr/blob/master/vignettes/LDpred2.Rmd).
**bigsnpr** is released under the GPL-3 license (<https://privefl.github.io/bigsnpr/>), and files provided here retains this license.

Please confer this [tutorial](https://privefl.github.io/bigsnpr/articles/LDpred2.html) for additional explainations of the actual codes.

The main difference from the original file is that data and summary stats files used (in `/tutorial_data/`) is included in this repository
and should not require any other external data to run.

In order to run the R notebook, issue in the terminal:

```
R -e "rmarkdown::render('LDpred2.Rmd')"
```

### Output

The files generated by running the R notebook are:

- `LDpred2.pdf`: Rendered notebook and output in PDF file format compiled via LaTeX
- `Rplots.pdf`: Figure output
- `LDpred2_cache/`: misc. cache files
- `LDpred2_files/`: misc. files
- `tutorial_data/*.sbk`, `tutorial_data/*.bk`:

## `tutorial_data` directory

This directory includes some files used by the [tutorial](https://privefl.github.io/bigsnpr/articles/LDpred2.html) here included in the directory from
[https://figshare.com/ndownloader/files/37802721](https://figshare.com/ndownloader/files/37802721) and [github.com/privefl/bigsnpr/raw/master/data-raw/public-data3.zip](https://github.com/privefl/bigsnpr/raw/master/data-raw/public-data3.zip)

### Docker

Run using [Docker](https://www.docker.com) container, e.g., for local testing/development without Singularity

In case you wish to build the image, clone the entire repository, change directory to this one and issue

```
docker build -t ldpred2 -f ../src/dockerfiles/ldpred2/Dockerfile .
```

The build may take some time, and is assigned the ID `ldpred2`.

Then, one may mount the working directory to `/rscripts/` and run the example using `R` as:

```
docker run -p 49634:49634 --mount type=bind,source=$(pwd),target=/home/ ldpred2 R -e "rmarkdown::render('/home/LDpred2.Rmd')"
```

### Singularity

Get familiar with Singularity:

* ["singularity shell" options](https://sylabs.io/guides/3.2/user-guide/cli/singularity_shell.html#options)
* [Bind paths and mounts](https://sylabs.io/guides/3.2/user-guide/bind_paths_and_mounts.html).

In order to run the example from the terminal using Singularity, issue:

```
singularity exec --home $PWD:/home ../containers/ldpred2.sif R -e "rmarkdown::render('/home/LDpred2.Rmd')"
```

### Singularity + Slurm

TODO: document `LDpred2_slurm.job`